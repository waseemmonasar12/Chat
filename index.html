<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شات العائلة - مباشر</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { font-family: sans-serif; background: #e5ddd5; margin: 0; display: flex; justify-content: center; height: 100vh; }
        .app-container { width: 100%; max-width: 480px; background: #fff; display: flex; flex-direction: column; height: 100%; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        
        header { background: #075e54; color: white; padding: 15px; text-align: center; font-weight: bold; }
        
        /* منطقة ادخال الاسم - تظهر مرة واحدة */
        #nameInputArea { padding: 20px; text-align: center; background: #fff; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #username { padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 80%; margin-bottom: 10px; }
        .btn-start { background: #25D366; color: white; border: none; padding: 10px 30px; border-radius: 5px; cursor: pointer; }

        .chat-box { flex: 1; padding: 10px; overflow-y: auto; background: #e5ddd5; display: flex; flex-direction: column; gap: 8px; }
        
        .msg { padding: 8px 12px; border-radius: 8px; max-width: 75%; font-size: 14px; position: relative; word-wrap: break-word; }
        .msg.me { background: #dcf8c6; align-self: flex-end; }
        .msg.other { background: #fff; align-self: flex-start; }
        .sender-name { font-size: 10px; color: #555; margin-bottom: 3px; display: block; }

        .input-area { padding: 10px; background: #f0f0f0; display: flex; gap: 10px; }
        #messageInput { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; }
        .btn-send { background: #075e54; color: white; border: none; padding: 10px 15px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>

    <div class="app-container">
        <div id="nameInputArea">
            <h3>أهلاً بك!</h3>
            <p>اختر اسماً مستعاراً للدخول:</p>
            <input type="text" id="username" placeholder="اكتب اسمك هنا...">
            <button class="btn-start" onclick="enterChat()">دخول الشات</button>
        </div>

        <header>مجموعة العائلة ❤️</header>

        <div class="chat-box" id="chatBox">
            </div>

        <div class="input-area">
            <input type="text" id="messageInput" placeholder="اكتب رسالة...">
            <button class="btn-send" onclick="sendMessage()">➤</button>
        </div>
    </div>

    <script>
        // -----------------------------------------------------------
        // 1. إعدادات Firebase (يجب استبدال هذا الجزء بكودك الخاص)
        // -----------------------------------------------------------
        const firebaseConfig = {
  apiKey: "AIzaSyACnX1Xu-2XiyxYtGT_wUzfMqVcUddVxKs",
  authDomain: "chat-9c623.firebaseapp.com",
  databaseURL: "https://chat-9c623-default-rtdb.firebaseio.com",
  projectId: "chat-9c623",
  storageBucket: "chat-9c623.firebasestorage.app",
  messagingSenderId: "858118572582",
  appId: "1:858118572582:web:979ef639fed422a22ff4e7",
  measurementId: "G-THT2B1RYEK"
};
        // تهيئة التطبيق
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // متغيرات
        let myName = "";
        
        // دالة الدخول للشات
        function enterChat() {
            const nameField = document.getElementById("username");
            if (nameField.value.trim() !== "") {
                myName = nameField.value;
                document.getElementById("nameInputArea").style.display = "none";
            } else {
                alert("الرجاء كتابة اسمك أولاً");
            }
        }

        // دالة إرسال الرسالة
        function sendMessage() {
            const input = document.getElementById("messageInput");
            const msg = input.value;

            if (msg.trim() !== "") {
                // إرسال البيانات إلى Firebase
                database.ref("messages").push().set({
                    sender: myName,
                    text: msg,
                    timestamp: Date.now()
                });
                input.value = "";
            }
        }

        // الاستماع للرسائل الجديدة (تعمل تلقائياً عند وصول رسالة)
        database.ref("messages").on("child_added", function(snapshot) {
            const data = snapshot.val();
            const chatBox = document.getElementById("chatBox");
            
            // إنشاء عنصر الرسالة
            const msgDiv = document.createElement("div");
            
            // تحديد هل الرسالة مني أم من غيري
            if (data.sender === myName) {
                msgDiv.classList.add("msg", "me");
                msgDiv.innerHTML = `${data.text}`;
            } else {
                msgDiv.classList.add("msg", "other");
                msgDiv.innerHTML = `<span class="sender-name">${data.sender}</span>${data.text}`;
            }

            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // النزول لآخر رسالة
        });

        // إرسال عند ضغط Enter
        document.getElementById("messageInput").addEventListener("keypress", function(e) {
            if (e.key === "Enter") sendMessage();
        });

    </script>
</body>
</html>
